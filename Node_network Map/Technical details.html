<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <title>Technical details</title>
	<style>
	#main {
		position: absolute;
		width: 80%;
		left: 10%;
		border: 1px solid blue;
		padding:  10px 20px 20px 50px;
		font-size: 1.2em;
	}
	.codeDiv {
		border: 2px solid red;
		width: 60%;
	}
	</style>
</head>
<body>
	<div id= "main">
    <h1>Affichage d'un réseau avec Node_network_map</h1>
	<p>Une combinaison de requêtes Overpass, de fichier GeoJson intermédiaires et de quelques astuces permet de réutiliser la même page principale (Node_network_map.html) pour l'affichage de n'importe quel réseau connaissant simplement son identification (id) dans OSM. Dans l'exemple ici, le réseau pédestre du Bassin d'Aubenas (id:14209970)</p>
	<p>La carte est construite avec trois jeux de données : les panneaux de carrefour (<i>guideposts</i>), les trajets entre carrefours (<i>routes</i>) et les trajets reliant des réseaux différents (<i>connections</i>). Les deux premiers jeux peuvent être mis à jour rapidement avec une requête Overpass. Pour les trajets entre réseaux, certains gestionnaires préfèrent ne les tracer que dans la partie qui les concerne, le découpage "à la main" demande un peu de travail supplémentaire (<a href="https://pbalyx.github.io/gpx_tools/" >GpxView</a> peut aider) mais les mises à jour sont moins fréquentes.</p>
	
    <h2>Requêtes Overpass</h2>
	<h3><i>Routes hors connection</i></h3>
	<div id ="routesDiv" class= "codeDiv">
		<pre>
	[out:json][timeout:25];
	(
	   relation(id:14209970);  
	);
	rel(r:"");
	out geom;		</pre>
	</div>

	<h3><i>Connections</i></h3>
	<div id ="connectionsDiv" class= "codeDiv">		<pre>
	[out:json][timeout:25];
	(
	   relation(id:14209970);  
	);
	rel(r:"connection");
	out geom;		</pre>
	</div>

	<h3><i>Guideposts</i></h3>
	<div id ="guidepostsDiv" class= "codeDiv">
		<pre>
	[out:json][timeout:25];
	(
	   relation(id:14209970);  
	); > ->.a;
	(node.a  ["network:type"=node_network] -> .b;);
	(node(around.b:100)["information"="guidepost"]->.c;);
	.c out ;		</pre>
	</div>
	<p>Pour chaque requête, exporter le résultat en geojson (Exporter/Données/GeoJSON/télécharger), renommer le fichier et le compléter comme indiqué ci-dessous</p>
	
	<h2>Traitement des fichiers</h2>
	<p>Il est souvent difficile de lire des fichiers locaux directement depuis une page html  (rejet requête CORS...)
L'astuce pour simplifier est de transformer ces fichiers en script: il suffit de rajouter à chaque fichier une première ligne <br>
var <i>varname</i> =<br>
sans rien modifier d'autre et de le sauver comme <i>varname.txt</i> (attention à l'extension .txt) dans le même dossier que la page  <i>Node_network_map.html</i> .
La page html appelle ce fichier comme un script normal.
Pour les trois fichiers .geojson les noms de variable et de fichiers (<i>varname</i>) à utiliser sont:<br>
<i>guideposts</i> pour les panneaux,<br>
<i>routes</i> pour les trajets entre carrefours,<br>
<i>connections</i> pour les liaisons vers les autres réseaux.<br>
</p>
	<p></p>
	<p></p>
</div>
</body>
</html>

